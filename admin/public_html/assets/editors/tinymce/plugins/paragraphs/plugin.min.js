(function () {
    var paragraphs = (function () {
        'use strict';

        tinymce.PluginManager.add("paragraphs", function (editor, url) {
            
            // Registering the special format with a variable

  /*
            editor.on('KeyPress', function (e) {
                console.log('Element clicked:', e.target.nodeName);
                alert('1');
                
              });
*/
              editor.on('KeyDown', function (event) {

                if (event.keyCode === 9) {
                    event.preventDefault();
                    var currentParagraphs = new Number($(editor.selection.getNode()).css('text-indent').replace('px','')) + 0; 

                    
                        if(event.shiftKey) {                    
                            if(currentParagraphs > 30 ){
                                currentParagraphs =  currentParagraphs - 30;
                                editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px'}});
                                editor.formatter.apply('custom_paragraphs'); 
                            }
                            else{
                                editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : ''}});
                                editor.formatter.apply('custom_paragraphs'); 
                                editor.formatter.register('custom_paragraphs', {selector: 'p', styles: 'text-indent', remove: 'empty'});
                                editor.formatter.remove('custom_paragraphs')
                            }
                        }
                        else {
                            if(currentParagraphs < 600 ){
                                event.preventDefault();

                                var currentParagraphs = new Number($(editor.selection.getNode()).css('text-indent').replace('px','')) + 0; 
                                currentParagraphs = currentParagraphs + 30; //increase font by one
                        
                                editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px'}});
                                editor.formatter.apply('custom_paragraphs'); 
                            }
                        }
                    }
                  
                  //alert(event.keyCode);
                  return;
                //console.log('Element clicked:', e.target.nodeName);
                
                
              });
              /*
              
            
              editor.on('KeyUp', function (e) {
                  console.log('Element clicked:', e.target.nodeName);
                  alert('3');
                  
                });*/
            editor.shortcuts.add('Shift+Tab', "description of the shortcut", function() {
               
                var currentParagraphs = new Number($(editor.selection.getNode()).css('text-indent').replace('px','')) + 0; 
                currentParagraphs =  currentParagraphs + 30; //increase font by one
        
                editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px','padding-left' : '-' + currentParagraphs + 'px'}});
                editor.formatter.apply('custom_paragraphs'); 

            });

            function addParagraph()
            {
                var currentParagraphs = new Number($(editor.selection.getNode()).css('text-indent').replace('px','')) + 0; 
               // currentParagraphs =  currentParagraphs + 30; //increase font by one
        
               // editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px','padding-left' : '-' + currentParagraphs + 'px'}});
               // editor.formatter.apply('custom_paragraphs'); 

                if(currentParagraphs < 600 ){
                    currentParagraphs = currentParagraphs + 30; //increase font by one
            
                    editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px'}});
                    editor.formatter.apply('custom_paragraphs'); 
                }

            }

            function removeParagraph()
            {
                var currentParagraphs = new Number($(editor.selection.getNode()).css('text-indent').replace('px','')) + 0; 
                if(currentParagraphs > 30 ){
                    currentParagraphs =  currentParagraphs - 30;
                    editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : currentParagraphs + 'px'}});
                    editor.formatter.apply('custom_paragraphs'); 
                }
                else{
                    editor.formatter.register('custom_paragraphs', {selector : 'p', styles : {'text-indent' : ''}});
                    editor.formatter.apply('custom_paragraphs'); 
                    editor.formatter.register('custom_paragraphs', {selector: 'p', styles: 'text-indent', remove: 'empty'});
                    editor.formatter.remove('custom_paragraphs')
                }
            }

            // Define the Toolbar button
            editor.ui.registry.addButton('paragraphs-add', {
                icon: 'paragraph',
                text: "Adicionar Parágrafo",
                onAction: addParagraph
            });
            editor.ui.registry.addButton('paragraphs-remove', {
                icon: 'paragraph',
                text: "Remover Parágrafo",
                onAction: removeParagraph
            });
 

/*
            // Define the Menu Item
            editor.ui.registry.addMenuItem('paragraphs', {
                text: 'Hello Menu Item',
                context: 'insert',
                onAction: _onAction
            });
*/
            // Return details to be displayed in TinyMCE's "Help" plugin, if you use it
            // This is optional.
            return {
                getMetadata: function () {
                    return {
                        name: "Plugin Parágrafo Escrita Documento",
                        url: "https://www.easistemas.com.br"
                    };
                }
            };
        });
    }());
})();


